<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="en" translate="no">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Настройки</title>
    <meta name="description" content="Форум для Ваших идей. Смотрите, делитесь, вдохнавляйтесь и воплащайте!">

    <style th:replace="resources :: list-groups"></style>
    <style th:replace="resources :: list-groups-2"></style>
    <style th:replace="resources :: list-groups-3"></style>
    <style th:replace="resources :: select-none"></style>
    <style th:replace="resources :: buttons"></style>
    <style th:replace="resources :: close"></style>



    <link rel="icon" th:href="@{/images/favicon.png}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://getbootstrap.com/docs/5.2/examples/sidebars/sidebars.css" rel="stylesheet" crossorigin="anonymous">
</head>

<body style="min-height: 100vh;" th:class="'bg-' + ${theme == 'dark'? 'secondary' : 'white'}">
    <input type="hidden" id="theme" th:value="${theme}">

    <header th:replace="header :: header ('settings', ${theme})"></header>

    <div class="main"><div class="select-none">
        <form th:if="${@userAuth.isAuth()}">
            <div style="margin: 4rem auto; margin-top: 2rem;" class="list-group list-group-checkable d-grid gap-2 border-0 w-auto">
                <p style="text-right: left; margin-right: auto;" th:class="'mb-2 fs-2 fw-bold ' + ${theme == 'dark'? 'text-light' : 'text-dark'}">Безопасность</p>
                <button class="h-auto" style="width: 100%; padding-top: 13px; padding-bottom: 13px; text-align: left; border-radius: 0.5rem;" th:class="'btn btn-' + ${theme == 'dark'? 'drk' : 'lgt'}" id="chng1" onclick="window.location.href = '/password-change'" type="button">
                    Сменить пароль
                    <span class="d-block small opacity-50" id="thSpan1">Отправить письмо</span>
                </button>
                <button class="h-auto" style="width: 100%; padding-top: 13px; padding-bottom: 13px; text-align: left; border-radius: 0.5rem;" th:class="'btn btn-' + ${theme == 'dark'? 'drk' : 'lgt'}" id="chng2" onclick="window.location.href = '/change-email?from=settings'" type="button">
                    Сменить почту
                    <span class="d-block small opacity-50" id="thSpan2" th:text="'Текущая: ' + ${@userAuth.getCurrentEmail()}"></span>
                </button>
            </div>

            <div class="b-example-divider"></div>

        </form>

        <form>
            <div style="margin: 4rem auto; margin-top: 2rem;" class="list-group list-group-checkable d-grid gap-2 border-0 w-auto">
                <p style="text-right: left; margin-right: auto;" th:class="'mb-2 fs-2 fw-bold ' + ${theme == 'dark'? 'text-light' : 'text-dark'}">Тема</p>
                <input class="list-group-item-check pe-none" onclick="toDark();" type="radio" name="listGroupCheckableRadios" id="fListGroupCheckableRadios1" value="" data-np-checked="1">
                <label id="fLabel1" th:class="${(theme == 'light' ? 'light-theme' : 'dark-theme') + ' rounded-3 py-3'}" style="cursor: pointer;" for="fListGroupCheckableRadios1">
                    Тёмная тема
                    <span class="d-block small opacity-50" style="" id="fSpan1">Включить тёмную тему</span></label>

                <input class="list-group-item-check pe-none" type="radio" onclick="toLight();" name="listGroupCheckableRadios" id="fListGroupCheckableRadios2" value="" data-np-checked="1">
                <label id="fLabel2" th:class="${(theme == 'light' ? 'light-theme' : 'dark-theme') + ' rounded-3 py-3'}" style="cursor: pointer;" for="fListGroupCheckableRadios2">
                    Светлая тема
                    <span class="d-block small opacity-50" style="" id="fSpan2">Включить светлую тему</span></label>
            </div>
        </form>

    </div>
    </div>
    <script async src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js" integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk" crossorigin="anonymous"></script>
    <script async src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js" integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK" crossorigin="anonymous"></script>
    <script async src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js" integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK" crossorigin="anonymous"></script>
    <script async th:replace="resources :: settings-script"></script>
    <script async src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.5.1.min.js"></script>
    <script async src="/upload.js" th:src="@{/scripts/upload.js}"></script>

    <div id="temp" style="visibility: hidden; background-size: cover;background-repeat: no-repeat;background-position: center;width: 45px;height: 45px;display: inline-block; vertical-align: middle;"
         class="rounded-circle"> </div>
    <script>
       function sendRequest(method, url, body = null) {
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest()

                    xhr.open(method, url)

                    xhr.responseType = 'text'
                    xhr.setRequestHeader('Content-Type', 'application/json')

                    xhr.onload = () => {
                        if (xhr.status == 302 || (xhr.responseURL !== url)) {
                          reject(xhr.response)
                          }
                        else {
                          resolve(xhr.response) }
                    }

                    xhr.onerror = () => {
                      reject(xhr.response)
                    }

                    xhr.send(JSON.stringify(body));
       })
  }
        sendRequest('POST', 'https://ideas-forum.herokuapp.com/avatar')
            .then(data => {
                    document.getElementById('temp').setAttribute('style', document.getElementById('temp').getAttribute('style') + 'background-image: url(' + data + ');');
                    console.log(document.getElementById('temp').getAttribute('style'));
                    document.getElementById('avatar').setAttribute('style', document.getElementById('temp').getAttribute('style'));
                    document.getElementById('avatar').style.visibility = '';
                    document.getElementById('imagePreview').setAttribute('style', document.getElementById('temp').getAttribute('style'));
                    document.getElementById('imagePreview').style.width = ''; document.getElementById('imagePreview').style.height = '';
                    document.getElementById('imagePreview').style.visibility = '';
                    document.getElementById('temp').remove();
                },
                error => {
                    document.getElementById('temp').setAttribute('style', document.getElementById('temp').getAttribute('style') + 'background-image: url(https://raw.githubusercontent.com/Krokochik/resources/main/guest.png);');
                    document.getElementById('avatar').setAttribute('style', document.getElementById('temp').getAttribute('style'));
                    document.getElementById('avatar').style.visibility = '';
                    document.getElementById('imagePreview').setAttribute('style', document.getElementById('temp').getAttribute('style'));
                    document.getElementById('imagePreview').style.width = ''; document.getElementById('imagePreview').style.height = '';
                    document.getElementById('imagePreview').style.visibility = '';
                    document.getElementById('temp').remove();
                });
    </script>
</body>
</html>